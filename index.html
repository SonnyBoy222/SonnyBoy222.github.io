<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>母亲节祝福</title>
    <style>
        body {
            background: linear-gradient(135deg, #ffe6f2 30%, #f0f8ff);
            font-family: "Microsoft YaHei", sans-serif;
            padding: 20px;
        }

        #blessing-wall {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255,255,255,0.92);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .message-card {
            background: #fff0f5;
            padding: 15px;
            margin: 10px 0;
            border-left: 5px solid #ff69b4;
            animation: fadeIn 0.8s ease-out forwards;
        }

        #countdown {
            padding: 15px 20px;
            margin: 20px 0;
            background: rgba(255,105,180,0.1);
            border-radius: 8px;
            text-align: center;
            color: #d6336c;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
<div id="blessing-wall">
    <div id="countdown">加载中...</div>
    <div id="message-container"></div>
    <form id="message-form">
        <input type="text" id="message-input" placeholder="写下您的祝福..." style="width:70%; padding:8px;">
        <button type="submit" style="padding:8px 20px; background:#ff69b4; color:white; border:none; border-radius:4px;">提交祝福</button>
    </form>
</div>

<script>
    // ========== Token配置部分（需要修改） ========== 
    const tokenSeg1 = 'ghp_e1ufW7NRMULi';   // Token前半部分
    const tokenSeg2 = 'Ryzun8BGmhTEY4QLSx'; // Token后半部分
    // =============================================

    // GitHub配置
    const CONFIG = {
        owner: 'SonnyBoy222',
        repo: 'SonnyBoy222.github.io',
        branch: 'Mo3',
        path: 'messages.json',
        get token() { return tokenSeg1 + tokenSeg2; } // 动态组合Token
    };

    // GitHub API交互模块
    const githubAPI = {
        async getFileSHA() {
            const response = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
                headers: { Authorization: `token ${CONFIG.token}` } 
            });
            return (await response.json()).sha;
        },

        async loadMessages() {
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
                    headers: { Authorization: `token ${CONFIG.token}` }
                });
                const data = await response.json();
                return JSON.parse(atob(data.content.replace(/\s/g, '')));
            } catch (error) {
                console.error('加载失败:', error);
                return [];
            }
        },

        async saveMessages(messages) {
            try {
                const sha = await this.getFileSHA();
                const content = btoa(JSON.stringify(messages));
                
                const response = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`, {
                    method: 'PUT',
                    headers: { Authorization: `token ${CONFIG.token}` },
                    body: JSON.stringify({
                        message: '母亲节祝福更新',
                        content: content,
                        branch: CONFIG.branch,
                        sha: sha
                    })
                });
                return response.ok;
            } catch (error) {
                console.error('保存失败:', error);
                return false;
            }
        }
    };

    // 页面功能模块
    const renderMessages = async () => {
        const container = document.getElementById('message-container');
        const messages = await githubAPI.loadMessages();
        
        container.innerHTML = messages.reverse().map(msg => `
            <div class="message-card">
                <p>${msg.text}</p>
                <small>${msg.timestamp}</small>
            </div>
        `).join('');
    };

    // 倒计时功能
    function updateCountdown() {
        const nextYear = new Date().getFullYear() + 1;
        const target = new Date(`${nextYear}-05-11`);
        const now = new Date();
        const days = Math.ceil((target - now) / 86400000);
        document.getElementById('countdown').innerHTML = 
            `距离${nextYear}年母亲节还有 <strong>${days}</strong> 天`;
    }

    // 表单提交
    document.getElementById('message-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const input = document.getElementById('message-input');
        const message = input.value.trim();

        if (message) {
            try {
                const messages = await githubAPI.loadMessages();
                messages.push({
                    text: message,
                    timestamp: new Date().toLocaleString(),
                    id: Date.now()
                });

                if (messages.length > 100) messages.splice(0, messages.length - 100);
                
                if (await githubAPI.saveMessages(messages)) {
                    await renderMessages();
                    input.value = '';
                } else {
                    alert('提交失败，请检查网络或Token权限');
                }
            } catch (error) {
                console.error('提交异常:', error);
                alert('系统繁忙，请稍后再试');
            }
        }
    });

    // 初始化
    window.addEventListener('DOMContentLoaded', async () => {
        await renderMessages();
        updateCountdown();
        setInterval(updateCountdown, 1000);
    });
</script>
</body>
</html>


